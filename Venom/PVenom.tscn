[gd_scene load_steps=35 format=2]

[ext_resource path="res://Venom/WispySmoke01_8x8.tga" type="Texture" id=1]
[ext_resource path="res://Venom/dotted_line.png" type="Texture" id=2]
[ext_resource path="res://Venom/t_fx_smoke.TGA" type="Texture" id=3]
[ext_resource path="res://Venom/light_big.png" type="Texture" id=4]
[ext_resource path="res://Venom/PDust.tscn" type="PackedScene" id=5]

[sub_resource type="Shader" id=8]
code = "shader_type canvas_item;

uniform float speed = 1.0;

void fragment() {
	vec2 moving_uv = vec2(UV.x-(TIME*speed), UV.y);
	moving_uv = fract(moving_uv);
	vec4 in_tex = texture(TEXTURE, moving_uv);
	COLOR = vec4(COLOR.r,COLOR.g,COLOR.b,in_tex.a);
}"

[sub_resource type="ShaderMaterial" id=9]
shader = SubResource( 8 )
shader_param/speed = 0.5

[sub_resource type="Gradient" id=86]
offsets = PoolRealArray( 0, 0.285714, 0.6875, 1 )
colors = PoolColorArray( 0.937255, 0.0196078, 0.945098, 0, 0.517647, 0.054902, 0.541176, 0.133333, 0.203922, 0.0313726, 0.211765, 0.207843, 0.937255, 0.0196078, 0.945098, 0 )

[sub_resource type="GradientTexture" id=87]
gradient = SubResource( 86 )

[sub_resource type="Curve" id=79]
_data = [ Vector2( 0, 0 ), 0.0, 0.0, 0, 0, Vector2( 0.489879, 0.381818 ), 0.0, 0.0, 0, 0, Vector2( 1, 0 ), 0.0, 0.0, 0, 0 ]

[sub_resource type="CurveTexture" id=83]
curve = SubResource( 79 )

[sub_resource type="ParticlesMaterial" id=85]
emission_shape = 1
emission_sphere_radius = 128.0
flag_disable_z = true
direction = Vector3( 0, -1, 0 )
flatness = 1.0
gravity = Vector3( 0, 0, 0 )
initial_velocity = 83.97
initial_velocity_random = 0.73
angular_velocity = 720.0
angular_velocity_random = 1.0
orbit_velocity = 0.0
orbit_velocity_random = 0.0
scale = 59.83
scale_random = 1.0
scale_curve = SubResource( 83 )
color = Color( 10, 10, 10, 1 )
color_ramp = SubResource( 87 )
hue_variation = 0.02
hue_variation_random = 1.0

[sub_resource type="Shader" id=12]
code = "// NOTE: Shader automatically converted from Godot Engine 3.5.1.stable's CanvasItemMaterial.

shader_type canvas_item;
render_mode blend_mix;
uniform int particles_anim_h_frames;
uniform int particles_anim_v_frames;
uniform bool particles_anim_loop;

void vertex() {
	float h_frames = float(particles_anim_h_frames);
	float v_frames = float(particles_anim_v_frames);
	VERTEX.xy /= vec2(h_frames, v_frames);
	float particle_total_frames = float(particles_anim_h_frames * particles_anim_v_frames);
	float particle_frame = floor(INSTANCE_CUSTOM.z * float(particle_total_frames));
	if (!particles_anim_loop) {
		particle_frame = clamp(particle_frame, 0.0, particle_total_frames - 1.0);
	} else {
		particle_frame = mod(particle_frame, particle_total_frames);
	}	UV /= vec2(h_frames, v_frames);
	UV += vec2(mod(particle_frame, h_frames) / h_frames, floor((particle_frame + 0.5) / h_frames) / v_frames);
}

void fragment(){
	
	vec4 img_color = texture(TEXTURE, UV);
	
	//COLOR = vec4(img_color.r*COLOR.r,img_color.g*COLOR.g,img_color.b*COLOR.b,img_color.a*COLOR.a);
}"

[sub_resource type="ShaderMaterial" id=2]
shader = SubResource( 12 )
shader_param/particles_anim_h_frames = 8
shader_param/particles_anim_v_frames = 8
shader_param/particles_anim_loop = false

[sub_resource type="Gradient" id=4]
offsets = PoolRealArray( 0, 0.0898438, 0.179688, 1 )
colors = PoolColorArray( 1, 1, 1, 0, 1, 1, 1, 0.458824, 1, 1, 1, 0.466667, 1, 1, 1, 0 )

[sub_resource type="GradientTexture" id=5]
gradient = SubResource( 4 )

[sub_resource type="Curve" id=6]
_data = [ Vector2( 0, 1 ), 0.0, 0.0, 0, 0, Vector2( 0.258065, 0.839773 ), 0.0, 0.0, 0, 0, Vector2( 1, 0.685227 ), 0.0, 0.0, 0, 0 ]

[sub_resource type="CurveTexture" id=7]
curve = SubResource( 6 )

[sub_resource type="ParticlesMaterial" id=3]
emission_shape = 1
emission_sphere_radius = 72.9
flag_disable_z = true
direction = Vector3( 0, -1, 0 )
spread = 14.01
gravity = Vector3( 0, 0, 0 )
initial_velocity = 100.0
angular_velocity = 1.0
angular_velocity_random = 1.0
orbit_velocity = 0.0
orbit_velocity_random = 1.0
linear_accel = 100.0
linear_accel_random = 1.0
radial_accel = -50.0
radial_accel_random = 1.0
damping = 18.54
damping_random = 0.19
scale = 1.5
scale_random = 1.0
scale_curve = SubResource( 7 )
color = Color( 0.709804, 0.109804, 0.788235, 1 )
color_ramp = SubResource( 5 )
hue_variation = 0.01
hue_variation_random = 1.0
anim_speed = 1.0

[sub_resource type="Shader" id=13]
code = "shader_type canvas_item;

uniform sampler2D smoke;
uniform float speed = 0.3;
uniform float size = 0.08;
uniform sampler2D mask;

void fragment(){
	
	vec2 smoke_uv = UV + TIME * speed;
	vec4 smoke_color = texture(smoke, fract(smoke_uv));
	smoke_color = clamp(smoke_color * size, 0.0, 1.0);
	
	vec4 mask_color = texture(mask,UV);
	
	vec4 img_color = texture(SCREEN_TEXTURE, SCREEN_UV + vec2(smoke_color.g - size/2.0,0.0));
	
	COLOR = vec4(img_color.r,img_color.g,img_color.b,mask_color.r);
	//COLOR.a = img_color.r;
}"

[sub_resource type="ShaderMaterial" id=14]
shader = SubResource( 13 )
shader_param/speed = 0.3
shader_param/size = 0.01
shader_param/smoke = ExtResource( 3 )
shader_param/mask = ExtResource( 4 )

[sub_resource type="ParticlesMaterial" id=15]
flag_disable_z = true
direction = Vector3( 0, -1, 0 )
gravity = Vector3( 0, 0, 0 )
initial_velocity = 335.87
orbit_velocity = 0.0
orbit_velocity_random = 0.0
scale = 153.67

[sub_resource type="Shader" id=18]
code = "shader_type canvas_item;

uniform float progress1:hint_range(0.0, 1.0, 0.01) = 0.0;
uniform float progress2:hint_range(0.0, 1.0, 0.01) = 0.0;

//------------------------------------------------------------
uniform sampler2D noise;
uniform float progress4:hint_range(0.0, 1.0) = 0.0;
uniform vec4 edge_color:hint_color;

// 粒子寿命
varying float lifetime;
void vertex(){
	lifetime = INSTANCE_CUSTOM.y - 0.5;
}
 
void fragment(){
	// 做遮罩
	vec2 uv = UV;
	uv.x = uv.x-0.5;
	uv.y = uv.y+0.4;
	float a = length(uv);
	a = 1.0-smoothstep(0.52,0.5,a*progress1);
	//COLOR = vec4(a,a,a,1.0);
	
	vec2 uv2 = UV;
	uv2.x = uv2.x-0.5;
	uv2.y = uv2.y-0.5;
	float b = length(uv2*2.0);
	float c = smoothstep(0.52,0.5,b*progress2);
	
	float d = clamp(c-a,0.0,1.0);
	//COLOR = vec4(d,d,d,d);
	
	float e = smoothstep(0.52,0.4,b*progress2);
	float f = clamp(e-a,0.0,1.0);
	f = clamp(d-f,0.0,1.0);
	float g = clamp(d-f,0.0,1.0);
	//COLOR = vec4(f);
	
	vec4 a_color = vec4(g,g,g,g) * COLOR;
	vec4 b_color = vec4(f,f,f,f) * edge_color;
	COLOR = a_color + b_color;
	
	// 溶解
	vec4 noise_color = texture(noise,UV);
	
	float noise_mask = step(0.0,noise_color.r+UV.g - lifetime*2.);
	vec3 noise_mask_edge = vec3(noise_mask - step(0.0,noise_color.r+UV.g - (lifetime * 2.0 + 0.07)));
	
	COLOR.a = clamp(COLOR.a * noise_mask,0.0,1.0);
	COLOR.rgb = clamp(COLOR.rgb - noise_mask_edge,0.0,1.0) + noise_mask_edge * edge_color.rgb;
	
}"

[sub_resource type="ShaderMaterial" id=19]
shader = SubResource( 18 )
shader_param/progress1 = 0.5
shader_param/progress2 = 0.59
shader_param/progress4 = 0.0
shader_param/edge_color = Color( 0.94902, 0.00392157, 1, 1 )
shader_param/noise = ExtResource( 3 )

[sub_resource type="Gradient" id=23]
offsets = PoolRealArray( 0, 0.786047, 1 )
colors = PoolColorArray( 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0 )

[sub_resource type="GradientTexture" id=24]
gradient = SubResource( 23 )

[sub_resource type="Curve" id=20]
_data = [ Vector2( 0, 0 ), 0.0, 0.0, 0, 0, Vector2( 0.672269, 0.572727 ), 1.94727, 1.94727, 0, 0, Vector2( 1, 1 ), 0.0, 0.0, 0, 0 ]

[sub_resource type="CurveTexture" id=21]
curve = SubResource( 20 )

[sub_resource type="ParticlesMaterial" id=22]
emission_shape = 1
emission_sphere_radius = 128.0
flag_disable_z = true
gravity = Vector3( 0, 0, 0 )
orbit_velocity = 0.0
orbit_velocity_random = 0.0
scale = 39.17
scale_random = 1.0
scale_curve = SubResource( 21 )
color = Color( 0.278431, 0.0313726, 0.27451, 1 )
color_initial_ramp = SubResource( 24 )

[sub_resource type="Shader" id=10]
code = "shader_type canvas_item;

uniform sampler2D smoke;
uniform float speed = 0.3;
uniform float size = 0.08;

void fragment(){
	
	vec2 smoke_uv = UV + TIME * speed;
	vec4 smoke_color = texture(smoke, fract(smoke_uv));
	smoke_color = clamp(smoke_color * size, 0.0, 1.0);
	
	vec4 img_color = texture(SCREEN_TEXTURE, SCREEN_UV + vec2(smoke_color.g - size/2.0,0.0));
	
	COLOR = vec4(img_color);
}"

[sub_resource type="ShaderMaterial" id=11]
shader = SubResource( 10 )
shader_param/speed = 0.3
shader_param/size = 0.017
shader_param/smoke = ExtResource( 3 )

[sub_resource type="Shader" id=16]
code = "shader_type canvas_item;

uniform float progress1:hint_range(0.0, 1.0, 0.01) = 0.0;
uniform float progress2:hint_range(0.0, 1.0, 0.01) = 0.0;

//------------------------------------------------------------
uniform sampler2D noise;
uniform float progress4:hint_range(0.0, 1.0) = 0.0;
uniform vec4 edge_color:hint_color;

void fragment(){
	// 做遮罩
	vec2 uv = UV;
	
	uv.x = uv.x-0.5;
	uv.y = uv.y+0.4;
	
	float a = length(uv);
	
	a = 1.0-smoothstep(0.52,0.5,a*progress1);
	COLOR = vec4(a,a,a,1.0);
	
	vec2 uv2 = UV;
	uv2.x = uv2.x-0.5;
	uv2.y = uv2.y-0.5;
	float b = length(uv2*2.0);
	float c = smoothstep(0.52,0.5,b*progress2);
	
	float d = clamp(c-a,0.0,1.0);
	COLOR = vec4(d,d,d,d);
	
	float e = smoothstep(0.52,0.4,b*progress2);
	float f = clamp(e-a,0.0,1.0);
	f = clamp(d-f,0.0,1.0);
	float g = clamp(d-f,0.0,1.0);
	//COLOR = vec4(f);
	
	vec4 a_color = vec4(g,g,g,g) * COLOR;
	vec4 b_color = vec4(f,f,f,f) * edge_color;
	COLOR = a_color + b_color;
	
	// 溶解
	vec4 noise_color = texture(noise,UV);
	
	float noise_mask = step(0.0,noise_color.r+UV.g - progress4*2.);
	vec3 noise_mask_edge = vec3(noise_mask - step(0.0,noise_color.r+UV.g - (progress4 * 2.0 + 0.07)));
	COLOR.a = clamp(COLOR.a * noise_mask,0.0,1.0);
	COLOR.rgb = clamp(COLOR.rgb - noise_mask_edge,0.0,1.0) + noise_mask_edge * edge_color.rgb;
}"

[sub_resource type="ShaderMaterial" id=17]
shader = SubResource( 16 )
shader_param/progress1 = 0.48
shader_param/progress2 = 0.64
shader_param/progress4 = 0.405
shader_param/edge_color = Color( 0.670588, 0.25098, 0.25098, 1 )
shader_param/noise = ExtResource( 3 )

[sub_resource type="Environment" id=88]
background_mode = 4
glow_enabled = true
glow_intensity = 0.15
glow_strength = 0.72
glow_blend_mode = 1
glow_bicubic_upscale = true
glow_high_quality = true

[node name="PVenom" type="Node2D"]

[node name="Polygon2D" type="Polygon2D" parent="."]
color = Color( 0.431373, 0.0470588, 0.415686, 1 )
antialiased = true
polygon = PoolVector2Array( 80, -304, -294, 10, 166, 210, 363, -38 )

[node name="Line2D" type="Line2D" parent="."]
material = SubResource( 9 )
points = PoolVector2Array( -3, -289, -298, 0, -3, 267, 282, 0, 2, -287 )
width = 25.0
default_color = Color( 7.3, 0, 6.8, 1 )
texture = ExtResource( 2 )
texture_mode = 1
joint_mode = 1

[node name="PDust" parent="." instance=ExtResource( 5 )]
position = Vector2( 0, 0 )
process_material = SubResource( 85 )

[node name="Psmoke" type="Particles2D" parent="."]
modulate = Color( 1, 1, 1, 0.203922 )
material = SubResource( 2 )
z_index = 2
amount = 50
lifetime = 2.5
randomness = 1.0
process_material = SubResource( 3 )
texture = ExtResource( 1 )

[node name="Particles2D" type="Particles2D" parent="."]
material = SubResource( 14 )
z_index = 2
amount = 5
process_material = SubResource( 15 )

[node name="Particles2D2" type="Particles2D" parent="."]
material = SubResource( 19 )
lifetime = 2.0
randomness = 1.0
process_material = SubResource( 22 )

[node name="ColorRect" type="ColorRect" parent="."]
visible = false
material = SubResource( 11 )
margin_left = -460.0
margin_top = -333.0
margin_right = 706.0
margin_bottom = 328.0

[node name="ColorRect2" type="ColorRect" parent="."]
material = SubResource( 17 )
margin_left = 372.0
margin_top = 98.0
margin_right = 628.0
margin_bottom = 354.0

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource( 88 )
